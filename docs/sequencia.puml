
@startuml SADFI_Sequencia_Sprint2_Rev_Fix

title SAD-FI â€“ Diagrama de SequÃªncia (Sprint 2, revisÃ£o mÃ­nima â€“ corrigido)

skinparam defaultFontName Arial
skinparam shadowing false
skinparam sequence {
  ArrowColor #333333
  LifeLineBorderColor #333333
  LifeLineBackgroundColor #FFFFFF
  ParticipantBorderColor #333333
  ParticipantBackgroundColor #FFFFFF
  BoxBorderColor #999999
  BoxBackgroundColor #F9F9F9
}

actor UI as UI
participant "ControladorApp" as Ctrl
participant "Financiamento" as Fin
participant "SimuladorSAC" as SimSAC
participant "SimuladorSAC_IPCA" as SimIPCA
participant "TabelaIPCA" as TabIPCA
participant "ComparadorModalidades" as Comp
participant "RecomendadorModalidade" as Rec
participant "exportador_csv (funÃ§Ã£o)" as ExpCSV

== Entrada e SimulaÃ§Ã£o ==
UI -> Ctrl: executar_simulacao(dados_entrada)
activate Ctrl
Ctrl -> Fin: new(valor_total, entrada, prazo_anos, sistema, taxa_juros_anual)
activate Fin
Fin --> Ctrl: instancia
deactivate Fin

alt sistema == "SAC"
  Ctrl -> SimSAC: simular(usar_tr, tr_mensal)\nâ†’ SimulacaoResultado
  activate SimSAC
  SimSAC --> Ctrl: resultado_sac
  deactivate SimSAC
else sistema == "SAC_IPCA"
  Ctrl -> TabIPCA: new(caminho_ipca)  ' valida arquivo
  activate TabIPCA
  TabIPCA --> Ctrl: instancia
  deactivate TabIPCA

  Ctrl -> SimIPCA: simular()\nâ†’ SimulacaoResultado
  activate SimIPCA
  note over SimIPCA
    Para cada mÃªs:
    ipca_mensal = TabIPCA.get_ipca(m)
    corrige saldo â†’ aplica juros â†’ amortiza
  end note
  SimIPCA --> Ctrl: resultado_ipca
  deactivate SimIPCA
end

deactivate Ctrl

== ComparaÃ§Ã£o e RecomendaÃ§Ã£o ==
Ctrl -> Comp: comparar(resultado1, resultado2)
activate Comp
Comp --> Ctrl: mensagem_comparacao
deactivate Comp

Ctrl -> Rec: recomendar({mensagem_comparacao})
activate Rec
Rec --> Ctrl: "ðŸ’¡ Recomendado: ..."
deactivate Rec

== ExportaÃ§Ã£o (opcional) ==
opt ExportaÃ§Ã£o solicitada pelo usuÃ¡rio
  Ctrl -> Ctrl: resultado.to_dataframe()
  Ctrl -> ExpCSV: exportar_cronograma_csv(df, nome_base)\nâ†’ caminho.csv
end

UI <-- Ctrl: resumo, comparaÃ§Ã£o, recomendaÃ§Ã£o, [caminho.csv]

@enduml
